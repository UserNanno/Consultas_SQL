-- Databricks SQL

WITH
-- 1) Fuente filtrada: pushdown de filtros tempranos
src AS (
  SELECT *
  FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDTARJETACREDITO
  WHERE CODTIPREGAPP IN ('0126O000001xsIYQAY','0126O000001h0WaQAI','0126O000001h0WbQAI')
    AND FECSOLICITUD >= DATE '2025-10-01'
),

-- 2) Roles: se mantienen los tipos de JOIN y condiciones tal cual el original
titular AS (
  SELECT *
  FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDINDIVIDUO
  WHERE DESTIPROLSOLICITUD = 'TITULAR'
),
conyuge_indv AS (
  -- IMPORTANTE: Mantenemos la condición “errónea” del original (join vía B) para **no cambiar la semántica**.
  -- En la práctica, esto hace que nunca exista match para C y sus campos queden NULL (igual que el original).
  SELECT *
  FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDINDIVIDUO
  -- sin filtrar DESTIPROLSOLICITUD aquí; la condición de join se replica más adelante
),
party_titular AS (
  SELECT *
  FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDPARTY
  WHERE DESTIPROLSOLICITUD = 'TITULAR'
),
party_conyuge AS (
  SELECT *
  FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDPARTY
  WHERE DESTIPROLSOLICITUD = 'CONYUGE'
),
usuarios AS (
  SELECT *
  FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_USUARIOAPLICATIVO
),

-- 3) Enriquecimiento base: derivadas reutilizables y normalización ligera
base AS (
  SELECT
    A.CODSOLICITUD,

    /* Timestamps base reutilizados luego */
    to_timestamp(concat_ws(' ', A.FECSOLICITUD, lpad(A.HORSOLICITUD, 6, '0')), 'yyyy-MM-dd HHmmss') AS FECREGISTRO,
    to_timestamp(concat_ws(' ', A.FECINICIOEVALUACION, lpad(A.HORINICIOEVALUACION, 6, '0')), 'yyyy-MM-dd HHmmss') AS INICIOEVALUACION,
    to_timestamp(concat_ws(' ', A.FECFINEVALUACION, lpad(A.HORFINEVALUACION, 6, '0')), 'yyyy-MM-dd HHmmss') AS FINEVALUACION,

    /* Flags de campaña para no recalcular múltiples CONTAINS */
    A.DESCAMPANIA,
    A.DESTIPFLUJOVENTATARJETACREDITO,
    A.TIPESTADOSOLICITUD,
    A.DESTIPETAPA,
    A.DESMOTIVOCDA,
    A.DESCOMENTARIO,
    A.DESPRODUCTO,
    A.NBRMONEDA,
    A.MTOSOLICITADO,
    A.MTOAPROBADO,
    A.FECEMISIONTARJETACREDITO,
    A.CODMATRICULACOLABORADORAPROBADOR,
    A.CODMATRICULACOLABORADORVENDEDOR,
    A.CODCOLABORADORVENDEDOR,
    A.CODINTERNOCOMPUTACIONAL,
    A.MTOCUOTAMENSUALAPROBADO,
    A.PCTTASAEFECTIVAANUALSOLICITUD,
    A.MTOINGRESOBRUTOSOLICITUD,
    A.FECSOLICITUD
  FROM src A
),

-- 4) Clasificaciones que se repiten (producto/subproducto/campaña/resultado/estado)
clasif AS (
  SELECT
    b.*,

    /* TIPOEVALUACION */
    CASE WHEN b.CODMATRICULACOLABORADORAPROBADOR IS NOT NULL
         THEN 'EVLUACION EN CENTRALIZADO'      -- (sic) se respeta texto original
         ELSE 'EVALUACION AUTOMATICA'
    END AS TIPOEVALUACION,

    /* TIPOPRODUCTO */
    CASE
      WHEN b.DESTIPFLUJOVENTATARJETACREDITO IN ('EP','PTC','BT','AMPLIACION','UPGRADE','ADICIONAL')
        THEN 'TARJETA CREDITO STOCK'
      WHEN b.DESTIPFLUJOVENTATARJETACREDITO IN ('SEGUNDA TC','TC')
        THEN 'TARJETA CREDITO NUEVA'
      WHEN contains(b.DESCAMPANIA, 'PRESTAMO TAR') OR contains(b.DESCAMPANIA, 'PRÉSTAMO TAR')
        OR contains(b.DESCAMPANIA, 'PTC') OR contains(b.DESCAMPANIA, 'EP')
        OR contains(b.DESCAMPANIA, 'BALANCE TRA') OR contains(b.DESCAMPANIA, 'TC+BT')
        OR contains(b.DESCAMPANIA, 'BT') OR contains(b.DESCAMPANIA, 'AMPLIACION')
        OR contains(b.DESCAMPANIA, 'AMPLIACIÓN') OR contains(b.DESCAMPANIA, 'UPGRADE')
        OR contains(b.DESCAMPANIA, 'UPG') OR contains(b.DESCAMPANIA, 'ADICIONAL')
        THEN 'TARJETA CREDITO STOCK'
      ELSE 'SIN DATA'
    END AS TIPOPRODUCTO,

    /* SUBPRODUCTO */
    CASE
      WHEN b.DESTIPFLUJOVENTATARJETACREDITO = 'EP' THEN 'PTC'
      WHEN b.DESTIPFLUJOVENTATARJETACREDITO = 'SEGUNDA TC' THEN 'TC'
      WHEN b.DESTIPFLUJOVENTATARJETACREDITO IS NOT NULL THEN b.DESTIPFLUJOVENTATARJETACREDITO
      WHEN contains(b.DESCAMPANIA, 'PRESTAMO TAR') OR contains(b.DESCAMPANIA, 'PRÉSTAMO TAR')
           OR contains(b.DESCAMPANIA, 'PTC') OR contains(b.DESCAMPANIA, 'EP') THEN 'PTC'
      WHEN contains(b.DESCAMPANIA, 'BALANCE TRA') OR contains(b.DESCAMPANIA, 'TC+BT') OR contains(b.DESCAMPANIA, 'BT') THEN 'BT'
      WHEN contains(b.DESCAMPANIA, 'AMPLIACION') OR contains(b.DESCAMPANIA, 'AMPLIACIÓN') THEN 'AMPLIACION'
      WHEN contains(b.DESCAMPANIA, 'UPGRADE') OR contains(b.DESCAMPANIA, 'UPG') THEN 'UPGRADE'
      WHEN contains(b.DESCAMPANIA, 'ADICIONAL') THEN 'ADICIONAL'
      ELSE 'Sin data'
    END AS SUBPRODUCTO,

    /* RESULTADOANALISTA */
    CASE
      WHEN b.TIPESTADOSOLICITUD = 'ACPD' THEN 'ACEPTADA'
      WHEN b.TIPESTADOSOLICITUD = 'DCLD' THEN 'DENEGADA'
      WHEN b.TIPESTADOSOLICITUD = 'ENPR' THEN 'EN PROCESO'
      WHEN b.TIPESTADOSOLICITUD = 'IRFC' THEN 'INGRESADO'
      WHEN b.TIPESTADOSOLICITUD = 'EEEL' THEN 'EN PROCESO DE CALIFICACION'
      WHEN b.TIPESTADOSOLICITUD = 'DIGI' THEN 'DIGITADO'
      ELSE 'SIN DATA'
    END AS RESULTADOANALISTA,

    /* ESTADO_F */
    CASE
      WHEN b.TIPESTADOSOLICITUD = 'ACPD' AND b.DESTIPETAPA = 'CERRADA'    THEN 'ACEPTADA'
      WHEN b.TIPESTADOSOLICITUD = 'DCLD' AND b.DESTIPETAPA = 'RECHAZADA'  THEN 'DENEGADA'
      WHEN b.TIPESTADOSOLICITUD = 'ENPR' AND b.DESTIPETAPA = 'DESESTIMADA' THEN 'DESESTIMADA'
      WHEN b.TIPESTADOSOLICITUD = 'IRFC' AND b.DESTIPETAPA = 'PERDIDA'     THEN 'DESESTIMADA'
      WHEN b.TIPESTADOSOLICITUD = 'ENPR' THEN 'EN PROCESO'
      WHEN b.TIPESTADOSOLICITUD = 'IRFC' THEN 'INGRESADO'
      WHEN b.TIPESTADOSOLICITUD = 'EEEL' THEN 'EN PROCESO DE CALIFICACION'
      WHEN b.TIPESTADOSOLICITUD = 'DIGI' THEN 'DIGITADO'
      ELSE 'SIN DATA'
    END AS ESTADO_F,

    /* CAMPANACORTA */
    CASE
      WHEN contains(b.DESCAMPANIA, '100%')     THEN '100% APROBADO'
      WHEN contains(b.DESCAMPANIA, 'PREAPR')   THEN 'PREAPROBADO'
      WHEN contains(b.DESCAMPANIA, 'SIN CAMP') THEN 'SIN CAMPANIA'
      WHEN contains(b.DESCAMPANIA, 'INVITA')   THEN 'INVITADO'
      WHEN b.DESTIPFLUJOVENTATARJETACREDITO = 'EP' THEN 'PTC'
      WHEN b.DESTIPFLUJOVENTATARJETACREDITO = 'SEGUNDA TC' THEN 'TC'
      WHEN b.DESTIPFLUJOVENTATARJETACREDITO IS NOT NULL THEN b.DESTIPFLUJOVENTATARJETACREDITO
      WHEN contains(b.DESCAMPANIA, 'PRESTAMO TAR') THEN 'PTC'
      WHEN contains(b.DESCAMPANIA, 'PRÉTAMO TAR') THEN 'PTC'  -- (sic) se respeta typo original
      WHEN contains(b.DESCAMPANIA, 'PTC') THEN 'PTC'
      WHEN contains(b.DESCAMPANIA, 'EP') THEN 'PTC'
      WHEN contains(b.DESCAMPANIA, 'BALANCE TRA') THEN 'BT'
      WHEN contains(b.DESCAMPANIA, 'TC+BT') THEN 'BT'
      WHEN contains(b.DESCAMPANIA, 'BT') THEN 'BT'
      WHEN contains(b.DESCAMPANIA, 'AMPLIACION') OR contains(b.DESCAMPANIA, 'AMPLIACIÓN') THEN 'AMPLIACION'
      WHEN contains(b.DESCAMPANIA, 'UPGRADE') OR contains(b.DESCAMPANIA, 'UPG') THEN 'UPGRADE'
      WHEN contains(b.DESCAMPANIA, 'ADICIONAL') THEN 'ADICIONAL'
      ELSE 'SIN DATA'
    END AS CAMPANACORTA
  FROM base b
),

-- 5) Unimos todo y calculamos métricas finales
ensamble AS (
  SELECT
    A.CODSOLICITUD,
    A.FECREGISTRO,
    C.TIPOEVALUACION,
    C.TIPOPRODUCTO,
    C.SUBPRODUCTO,
    A.DESPRODUCTO,
    C.RESULTADOANALISTA,
    C.ESTADO_F,
    CAST(NULL AS STRING) AS RESULTADOMOTORDCA,
    A.DESMOTIVOCDA,
    A.DESTIPETAPA AS ETAPA,
    CAST(NULL AS STRING) AS JUSTIFICACIONANALISTA,
    A.DESCOMENTARIO AS COMENTARIOANALISTA,
    A.DESCAMPANIA AS CAMPANIA,
    C.CAMPANACORTA,
    A.NBRMONEDA AS MONEDA,
    A.MTOSOLICITADO,
    A.MTOAPROBADO,
    A.INICIOEVALUACION,
    A.FINEVALUACION,
    A.FECEMISIONTARJETACREDITO AS FECDESEMBOLSO,
    A.CODMATRICULACOLABORADORAPROBADOR AS MATANALISTA,
    A.CODMATRICULACOLABORADORVENDEDOR AS MATVENDEDOR,
    A.CODINTERNOCOMPUTACIONAL,

    -- Datos del titular (B)
    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.FLGCLIPAGOHABERESBCP END AS FLGPDH,
    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.TIPRENTA END AS TIPRENTATITULAR,
    -- Datos de conyuge (C): se preserva semántica original => NULL por la condición de join (ver join más abajo)
    CASE WHEN CI.DESTIPROLSOLICITUD = 'CONYUGE' THEN CI.TIPRENTA END AS TIPRENTACONYUGE,

    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.NUMPUNTAJEPRECALIF END AS SCOREEVALUACION,
    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.TIPPARTYIDENTIFICACION END AS TIPIDCTITULAR,
    CASE WHEN CI.DESTIPROLSOLICITUD = 'CONYUGE' THEN CI.TIPPARTYIDENTIFICACION END AS TIPIDCCONYUGE,

    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.MTOINGRESODIGITADO END AS INGRESOBRUTOTITULAR,
    CASE WHEN CI.DESTIPROLSOLICITUD = 'CONYUGE' THEN CI.MTOINGRESODIGITADO END AS INGRESOBRUTOCONYUGE,
    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.MTOOTROINGRESODIGITADO END AS OTROINGRESOBRUTOTITULAR,
    CASE WHEN CI.DESTIPROLSOLICITUD = 'CONYUGE' THEN CI.MTOOTROINGRESODIGITADO END AS OTROINGRESOBRUTOCONYUGE,
    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.MTOINGRESOCALCULADO END AS INGRESOPROMEDIOTITULAR,
    CASE WHEN CI.DESTIPROLSOLICITUD = 'CONYUGE' THEN CI.MTOINGRESOCALCULADO END AS INGRESOPROMEDIOCONYUGE,

    A.MTOCUOTAMENSUALAPROBADO,
    CAST(NULL AS INT) AS PLAZOSOLICITADO,
    CAST(NULL AS INT) AS PLAZOAPROBADO,
    A.PCTTASAEFECTIVAANUALSOLICITUD AS TASASOLICITADA,
    CAST(NULL AS DECIMAL(18,6)) AS TASAAPROBADA,

    B.MTOCEM AS CEM,
    B.MTOCEMASESORVENTA AS CEMVENDEDOR,
    B.MTOCEMANALISTACREDITO AS CEMANALISTACREDITO,

    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.DESSUBSEGMENTO END AS SEGMENTOTITULAR,
    CAST(NULL AS STRING) AS POSICIONCONSOLIDADA,

    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.CODSEGMENTORIESGOSCORE END AS SEGMENTORIESGOSTITULAR,
    -- (sic) se respeta el origen original:
    CASE WHEN CI.DESTIPROLSOLICITUD = 'CONYUGE' THEN CI.TIPPARTYIDENTIFICACION END AS SEGMENTORIESGOSCONYUGE,

    CAST(NULL AS DECIMAL(18,6)) AS MTODESEMBOLSADO,

    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.DESTIPNIVELEDUCACIONAL END AS GRADOINTRUSCCION,
    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.DESTIPOCUPACION END AS SITUACIONLAOBRALTITULAR,
    CASE WHEN CI.DESTIPROLSOLICITUD = 'CONYUGE' THEN CI.DESTIPOCUPACION END AS SITUACIONLAOBRALCONYUGE,

    CASE WHEN D.DESTIPROLSOLICITUD = 'TITULAR' THEN D.DESTIPCLASIFRIESGOCLI END AS CLASIFSBSTITULTAR,
    CASE WHEN E.DESTIPROLSOLICITUD = 'CONYUGE' THEN E.DESTIPCLASIFRIESGOCLI END AS CLASIFSBSCONYUGE,

    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.NUMDEPENDIENTE END AS NUMDEPENDIENTESTITULAR,
    CASE WHEN B.DESTIPROLSOLICITUD = 'TITULAR' THEN B.DESTIPESTCIVIL END AS ESTADOCIVIL,

    U.DESPOSICIONCOLABORADOR AS FUNCIONVENDEDOR,
    A.MTOINGRESOBRUTOSOLICITUD AS MTOINGRESOVERIFICADO,

    day(A.FECSOLICITUD)   AS DIASOLICITUD,
    month(A.FECSOLICITUD) AS MESSOLICITUD,
    year(A.FECSOLICITUD)  AS ANIOSOLICITUD,
    date_format(A.FECSOLICITUD, 'yyyyMM') AS CODMESSOLICITUD,

    /* Rangos por score: se respeta literal del original (incluye 'B. 301-300') */
    CASE
      WHEN B.NUMPUNTAJEPRECALIF <= 0 THEN 'SIN DATA'
      WHEN B.NUMPUNTAJEPRECALIF BETWEEN 1   AND 300 THEN 'A. 1-300'
      WHEN B.NUMPUNTAJEPRECALIF BETWEEN 301 AND 330 THEN 'B. 301-300'
      WHEN B.NUMPUNTAJEPRECALIF BETWEEN 331 AND 360 THEN 'C. 331-360'
      WHEN B.NUMPUNTAJEPRECALIF BETWEEN 361 AND 390 THEN 'D. 361-390'
      WHEN B.NUMPUNTAJEPRECALIF BETWEEN 391 AND 420 THEN 'E. 391-420'
      WHEN B.NUMPUNTAJEPRECALIF BETWEEN 421 AND 450 THEN 'F. 421-450'
      ELSE NULL
    END AS RANGOSCORE,

    /* Conversión a soles (se respeta string exacto de moneda) */
    CASE
      WHEN A.NBRMONEDA = 'DOLAR AMERICANO             EE.UU       ' THEN A.MTOSOLICITADO * 3.81
      ELSE A.MTOSOLICITADO
    END AS MTOSOLICITADOSOLES,
    CASE
      WHEN A.NBRMONEDA = 'DOLAR AMERICANO             EE.UU       ' THEN A.MTOAPROBADO * 3.81
      ELSE A.MTOAPROBADO
    END AS MTOAPROBADOSOLES,

    CAST(NULL AS DECIMAL(18,6)) AS MTODESEMBOLSADOSOLES,
    CAST(NULL AS STRING)        AS FLGMTODESEMBOLSADOSOLES
  FROM base A
  LEFT JOIN titular B
    ON A.CODSOLICITUD = B.CODSOLICITUD
  /* Mantener condición de C como en el SQL original (equivale a campos NULL) */
  LEFT JOIN conyuge_indv CI
    ON A.CODSOLICITUD = B.CODSOLICITUD AND B.DESTIPROLSOLICITUD = 'CONYUGE'
  LEFT JOIN party_titular D
    ON A.CODSOLICITUD = D.CODSOLICITUD
  LEFT JOIN party_conyuge E
    ON A.CODSOLICITUD = E.CODSOLICITUD
  LEFT JOIN usuarios U
    ON A.CODCOLABORADORVENDEDOR = U.CODUSUARIOAPP
  LEFT JOIN clasif C
    ON A.CODSOLICITUD = C.CODSOLICITUD
),

-- 6) Cálculos que dependen de alias previos (evitamos re-evaluar expresiones)
final AS (
  SELECT
    e.*,

    /* Rango por monto solicitado en soles: requiere alias previo */
    CASE
      WHEN MTOSOLICITADOSOLES <= 0 THEN 'SIN DATA'
      WHEN MTOSOLICITADOSOLES BETWEEN 1 AND 23000 THEN 'A. 1-23K'
      WHEN MTOSOLICITADOSOLES BETWEEN 23001 AND 46000 THEN 'B. 23K-46K'
      WHEN MTOSOLICITADOSOLES BETWEEN 46001 AND 69000 THEN 'C. 46K-69K'
      WHEN MTOSOLICITADOSOLES BETWEEN 69001 AND 92000 THEN 'D. 69K-92K'
      WHEN MTOSOLICITADOSOLES BETWEEN 92001 AND 115000 THEN 'E. 92K-115K'
      WHEN MTOSOLICITADOSOLES BETWEEN 115001 AND 138000 THEN 'F. 115K-138K'
      WHEN MTOSOLICITADOSOLES BETWEEN 138001 AND 160000 THEN 'G. 138K-160K'
      ELSE 'H. >160K'
    END AS RANGOMTOSOLICITADOSOLES,

    /* Tiempos con función nativa de Databricks/Spark: TIMESTAMPDIFF */
    timestampdiff(SECOND, FECREGISTRO,    FINEVALUACION) / 3600.0 AS TIEMPOCLIENTEHRS,
    timestampdiff(SECOND, INICIOEVALUACION, FINEVALUACION) / 3600.0 AS TIEMPOANALISTAHRS,
    timestampdiff(SECOND, FECREGISTRO,    FINEVALUACION)          AS TIEMPOCLIENTESEGUNDOS,
    timestampdiff(SECOND, INICIOEVALUACION, FINEVALUACION)         AS TIEMPOANALISTASEGUNDOS,

    CASE
      WHEN timestampdiff(SECOND, FECREGISTRO, FINEVALUACION) IS NULL THEN NULL
      WHEN (timestampdiff(SECOND, FECREGISTRO, FINEVALUACION) / 3600.0) <= 0 THEN 'SIN DATA'
      WHEN (timestampdiff(SECOND, FECREGISTRO, FINEVALUACION) / 3600.0) BETWEEN 1 AND 3  THEN 'A. 1-3'
      WHEN (timestampdiff(SECOND, FECREGISTRO, FINEVALUACION) / 3600.0) BETWEEN 4 AND 6  THEN 'B. 4-6'
      WHEN (timestampdiff(SECOND, FECREGISTRO, FINEVALUACION) / 3600.0) BETWEEN 7 AND 12 THEN 'C. 7-12'
      WHEN (timestampdiff(SECOND, FECREGISTRO, FINEVALUACION) / 3600.0) BETWEEN 13 AND 18 THEN 'D. 13-18'
      WHEN (timestampdiff(SECOND, FECREGISTRO, FINEVALUACION) / 3600.0) BETWEEN 19 AND 24 THEN 'E. 19-24'
      ELSE 'F. >24'
    END AS RANGOATENCIONCLIENTE
  FROM ensamble e
)

SELECT
  CODSOLICITUD,
  FECREGISTRO,
  TIPOEVALUACION,
  TIPOPRODUCTO,
  SUBPRODUCTO,
  DESPRODUCTO,
  RESULTADOANALISTA,
  ESTADO_F,
  RESULTADOMOTORDCA,
  DESMOTIVOCDA,
  ETAPA,
  JUSTIFICACIONANALISTA,
  COMENTARIOANALISTA,
  CAMPANIA,
  CAMPANACORTA,
  MONEDA,
  MTOSOLICITADO,
  MTOAPROBADO,
  INICIOEVALUACION,
  FINEVALUACION,
  FECDESEMBOLSO,
  MATANALISTA,
  MATVENDEDOR,
  CODINTERNOCOMPUTACIONAL,
  FLGPDH,
  TIPRENTATITULAR,
  TIPRENTACONYUGE,
  SCOREEVALUACION,
  TIPIDCTITULAR,
  TIPIDCCONYUGE,
  INGRESOBRUTOTITULAR,
  INGRESOBRUTOCONYUGE,
  OTROINGRESOBRUTOTITULAR,
  OTROINGRESOBRUTOCONYUGE,
  INGRESOPROMEDIOTITULAR,
  INGRESOPROMEDIOCONYUGE,
  MTOCUOTAMENSUALAPROBADO,
  PLAZOSOLICITADO,
  PLAZOAPROBADO,
  TASASOLICITADA,
  TASAAPROBADA,
  CEM,
  CEMVENDEDOR,
  CEMANALISTACREDITO,
  SEGMENTOTITULAR,
  POSICIONCONSOLIDADA,
  SEGMENTORIESGOSTITULAR,
  SEGMENTORIESGOSCONYUGE,
  MTODESEMBOLSADO,
  GRADOINTRUSCCION,
  SITUACIONLAOBRALTITULAR,
  SITUACIONLAOBRALCONYUGE,
  CLASIFSBSTITULTAR,
  CLASIFSBSCONYUGE,
  NUMDEPENDIENTESTITULAR,
  ESTADOCIVIL,
  FUNCIONVENDEDOR,
  MTOINGRESOVERIFICADO,
  DIASOLICITUD,
  MESSOLICITUD,
  ANIOSOLICITUD,
  CODMESSOLICITUD,
  RANGOSCORE,
  MTOSOLICITADOSOLES,
  MTOAPROBADOSOLES,
  MTODESEMBOLSADOSOLES,
  FLGMTODESEMBOLSADOSOLES,
  RANGOMTOSOLICITADOSOLES,
  TIEMPOCLIENTEHRS,
  TIEMPOANALISTAHRS,
  TIEMPOCLIENTESEGUNDOS,
  TIEMPOANALISTASEGUNDOS,
  RANGOATENCIONCLIENTE
FROM final;