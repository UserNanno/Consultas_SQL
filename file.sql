=SI([@TipoEvaluación]="EVALUACION AUTOMATICA";BUSCARV([@[a.destipestadosolicitud]];$BC$2:$BD$18;2;0);
SI(Y([@TipoEvaluación]="EVALUACION EN CENTRALIZADO";[@[f.destipetapa]]="Desestimada";[@resultadoanalista]<>"Aprobado por Analista de créditos";[@resultadoanalista]<>"Aprobado por Gerente - Firmas y Desembolso");"SOLICITUD CANCELADA";
SI(Y([@TipoEvaluación]="EVALUACION EN CENTRALIZADO";[@resultadoanalista]="NULL");BUSCARV([@[a.destipestadosolicitud]];$BC$2:$BD$18;2;0);
SI([@TipoEvaluación]="EVALUACION EN CENTRALIZADO";BUSCARV([@resultadoanalista];$AZ$2:$BA$15;2;0);
[@TipoEvaluación]))))



Tengo esta formula en excel y lo he tratado de adpatar en databricks asi

  (CASE
    WHEN C.OPERACION IS NOT NULL THEN 'EVALUACION EN CENTRALIZADO'
    ELSE 'EVALUACION AUTOMATICA'
  END) AS TIPEVALUACION,  -- DESTIPEVALUACIONSOLICITUD ( M_SOLICITUDCREDITOCONSUMO )
  (CASE
    WHEN C.OPERACION IS NULL THEN 
      (CASE 
        WHEN A.ESTADOSOLICITUD = 'SOLICITUD CANCELADA' THEN 'SOLICITUD CANCELADA - SALES'
        WHEN A.ESTADOSOLICITUD = 'DESACTIVADA' THEN 'DESACTIVADA - SALES'
        WHEN A.ESTADOSOLICITUD = 'DENEGADA' THEN 'DENEGADAS'
        WHEN A.ESTADOSOLICITUD = 'ACEPTADA' THEN 'ACEPTADAS'
        WHEN A.ESTADOSOLICITUD = 'EN PROCESO' THEN 'EN PROCESO - SALES'
        WHEN A.ESTADOSOLICITUD IS NULL THEN 'EN PROCESO - SALES'
      END)
    WHEN C.OPERACION IS NOT NULL AND A.DESTIPETAPA = 'DESESTIMADA' AND A.RESULTADOANALISTA NOT IN ('APROBADO POR ANALISTA DE CREDITOS', 'APROBADO POR GERENTE - FIRMAS Y DESEMBOLSO') THEN 'SOLICITUD CANCELADA'
    WHEN C.OPERACION IS NOT NULL AND A.RESULTADOANALISTA IS NULL THEN
      (CASE 
        WHEN A.ESTADOSOLICITUD = 'SOLICITUD CANCELADA' THEN 'SOLICITUD CANCELADA - SALES'
        WHEN A.ESTADOSOLICITUD = 'DESACTIVADA' THEN 'DESACTIVADA - SALES'
        WHEN A.ESTADOSOLICITUD = 'DENEGADA' THEN 'DENEGADAS'
        WHEN A.ESTADOSOLICITUD = 'ACEPTADA' THEN 'ACEPTADAS'
        WHEN A.ESTADOSOLICITUD = 'EN PROCESO' THEN 'EN PROCESO - SALES'
        WHEN A.ESTADOSOLICITUD IS NULL THEN 'EN PROCESO - SALES'
      END)
    WHEN C.OPERACION IS NOT NULL THEN
    (CASE
      WHEN A.RESULTADOANALISTA = 'APROBADO POR ANALISTA DE CREDITOS' THEN 'ACEPTADAS'
      WHEN A.RESULTADOANALISTA = 'APROBADO POR GERENTE - FIRMAS Y DESEMBOLSO' THEN 'ACEPTADAS'
      WHEN A.RESULTADOANALISTA = 'RECHAZADO POR GERENTE - DOCUMENTACION ADICIONAL' THEN 'DENEGADAS'
      WHEN A.RESULTADOANALISTA = 'RECHAZADO POR GERENTE - FIRMAS Y DESEMBOLSO' THEN 'DENEGADAS'
      WHEN A.RESULTADOANALISTA = 'ENVIADO A ANALISTA DE CREDITOS' THEN 'EN PROCESO - SALES'
      WHEN A.RESULTADOANALISTA = 'ENVIADO A GERENTE - DOCUMENTACION ADICIONAL' THEN 'EN PROCESO - SALES'
      WHEN A.RESULTADOANALISTA = 'ENVIADO A GERENTE - FIRMAS Y DESEMBOLSO' THEN 'EN PROCESO - SALES'
    END)
    ELSE
      (CASE
        WHEN C.OPERACION IS NOT NULL THEN 'EVALUACION EN CENTRALIZADO'
        ELSE 'EVALUACION AUTOMATICA'
      END) 
  END) AS ESTADORESULTADOANALISTA


Esta bien? 
