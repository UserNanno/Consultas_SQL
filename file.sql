WITH 
SOLICIUDTC AS (
  SELECT CODSOLICITUD, CODINTERNOCOMPUTACIONAL, DESPRODUCTO 
  FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDTARJETACREDITO
),
SOLICITUDINDIVIDUO AS (
  SELECT CODSOLICITUD, CODINTERNOCOMPUTACIONAL, TIPROLSOLICITUD, DESTIPROLSOLICITUD, TIPRENTA
  FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDINDIVIDUO
),
SOLICITUDPARTY AS (
  SELECT CODSOLICITUD, CODINTERNOCOMPUTACIONAL, TIPROLSOLICITUD, DESTIPROLSOLICITUD,
      (CASE
    	WHEN DESTIPROLSOLICITUD = 'TITULAR' THEN DESTIPCLASIFRIESGOCLI
    	ELSE NULL
    END) AS CLASIFICACIONSBSTITULAR,
    (CASE
    	WHEN DESTIPROLSOLICITUD = 'CONYUGE' THEN DESTIPCLASIFRIESGOCLI
    	ELSE NULL
    END) AS CLASIFICACIONSBSCONYUGE
  FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDPARTY
  WHERE DESTIPROLSOLICITUD IS NOT NULL
)
SELECT
  A.CODSOLICITUD,
  A.CODINTERNOCOMPUTACIONAL,
  A.DESPRODUCTO,
  B.TIPROLSOLICITUD,
  B.DESTIPROLSOLICITUD,
  B.TIPRENTA,
  C.TIPROLSOLICITUD,
  C.DESTIPROLSOLICITUD,
  C.CLASIFICACIONSBSTITULAR,
  C.CLASIFICACIONSBSCONYUGE
FROM SOLICIUDTC A
LEFT JOIN SOLICITUDINDIVIDUO B ON (A.CODSOLICITUD = B.CODSOLICITUD AND A.CODINTERNOCOMPUTACIONAL = B.CODINTERNOCOMPUTACIONAL)
LEFT JOIN SOLICITUDPARTY C ON (A.CODSOLICITUD = C.CODSOLICITUD AND A.CODINTERNOCOMPUTACIONAL = C.CODINTERNOCOMPUTACIONAL)
WHERE A.CODSOLICITUD = 'O0006733594';
