SELECT CODMES,
       COUNT(*) AS cnt
FROM CATALOG_LHCL_PROD_BCP_EXPL.BCP_EDV_RBMBDN.T72496_MIGRACION_PLANCHON
WHERE CODMES BETWEEN 202501 AND 202512
  AND DESTIPOPERACION IN ('TARJETA CREDITO NUEVA','TARJETA CREDITO STOCK')
  AND FECDESEMBOLSO IS NOT NULL
GROUP BY CODMES
ORDER BY CODMES;

-- 202501 | 56754
-- 202502 | 43643
-- 202503 | 48906
-- 202504 | 42951
-- 202505 | 42896
-- 202506 | 35652
-- 202507 | 44530
-- 202508 | 44122
-- 202509 | 47196
-- 202510 | 45466
-- 202511 | 41665
-- 202512 | 39666

SELECT
  CODMES,
  date_format(FECDESEMBOLSO, 'yyyyMM') AS CODMES_DESEMBOLSO,
  DESTIPOPERACION,
  COUNT(*) AS cnt
FROM CATALOG_LHCL_PROD_BCP_EXPL.BCP_EDV_RBMBDN.T72496_MIGRACION_PLANCHON
WHERE CODMES BETWEEN 202501 AND 202512
  AND DESTIPOPERACION IN ('TARJETA CREDITO NUEVA','TARJETA CREDITO STOCK')
  AND FECDESEMBOLSO IS NOT NULL
GROUP BY 1,2,3
ORDER BY 1,2,3;

/*
CODMES;CODMES_DESEMBOLSO;DESTIPOPERACION;cnt
202507;202508;TARJETA CREDITO NUEVA;17
202511;202512;TARJETA CREDITO NUEVA;24
202501;202501;TARJETA CREDITO STOCK;28072
202509;202510;TARJETA CREDITO STOCK;46
202509;202510;TARJETA CREDITO NUEVA;19
202501;202502;TARJETA CREDITO NUEVA;110
202512;202512;TARJETA CREDITO STOCK;14992
202507;202508;TARJETA CREDITO STOCK;35
202506;202507;TARJETA CREDITO STOCK;46
202507;202507;TARJETA CREDITO STOCK;19570
202508;202509;TARJETA CREDITO STOCK;40
202502;202503;TARJETA CREDITO STOCK;47
202509;202509;TARJETA CREDITO NUEVA;26402
202501;202502;TARJETA CREDITO STOCK;81
202503;202503;TARJETA CREDITO STOCK;19032
202511;202511;TARJETA CREDITO STOCK;16437
202512;202512;TARJETA CREDITO NUEVA;24622
202512;202601;TARJETA CREDITO STOCK;28
202507;202507;TARJETA CREDITO NUEVA;24904
202508;202508;TARJETA CREDITO NUEVA;23245
202509;202509;TARJETA CREDITO STOCK;20728
202505;202506;TARJETA CREDITO NUEVA;26
202506;202506;TARJETA CREDITO STOCK;13490
202506;202506;TARJETA CREDITO NUEVA;22079
202508;202508;TARJETA CREDITO STOCK;20818
202504;202504;TARJETA CREDITO STOCK;15956
202502;202503;TARJETA CREDITO NUEVA;32
202510;202510;TARJETA CREDITO NUEVA;26644
202505;202505;TARJETA CREDITO STOCK;16940
202511;202512;TARJETA CREDITO STOCK;40
202502;202502;TARJETA CREDITO STOCK;19050
202501;202501;TARJETA CREDITO NUEVA;28491
202510;202510;TARJETA CREDITO STOCK;18716
202506;202507;TARJETA CREDITO NUEVA;35
202505;202506;TARJETA CREDITO STOCK;47
202511;202511;TARJETA CREDITO NUEVA;25163
202510;202511;TARJETA CREDITO STOCK;62
202502;202506;TARJETA CREDITO STOCK;1
202504;202508;TARJETA CREDITO STOCK;1
202512;202601;TARJETA CREDITO NUEVA;24
202503;202504;TARJETA CREDITO NUEVA;157
202510;202512;TARJETA CREDITO STOCK;5
202503;202503;TARJETA CREDITO NUEVA;29613
202502;202502;TARJETA CREDITO NUEVA;24511
202504;202504;TARJETA CREDITO NUEVA;26881
202504;202505;TARJETA CREDITO NUEVA;57
202502;202505;TARJETA CREDITO STOCK;2
202505;202505;TARJETA CREDITO NUEVA;25883
202510;202511;TARJETA CREDITO NUEVA;39
202503;202504;TARJETA CREDITO STOCK;103
202504;202505;TARJETA CREDITO STOCK;56
202507;202509;TARJETA CREDITO STOCK;3
202507;202510;TARJETA CREDITO STOCK;1
202508;202509;TARJETA CREDITO NUEVA;18
202511;202601;TARJETA CREDITO STOCK;1
202508;202512;TARJETA CREDITO STOCK;1
202506;202508;TARJETA CREDITO STOCK;2
202509;202511;TARJETA CREDITO STOCK;1
202503;202506;TARJETA CREDITO NUEVA;1
*/




SELECT ESTADOSOLICITUD, COUNT(*) AS cnt
FROM CATALOG_LHCL_PROD_BCP_EXPL.BCP_EDV_RBMBDN.T72496_MIGRACION_PLANCHON
WHERE CODMES BETWEEN 202501 AND 202512
  AND DESTIPOPERACION IN ('TARJETA CREDITO NUEVA','TARJETA CREDITO STOCK')
  AND FECDESEMBOLSO IS NOT NULL
GROUP BY ESTADOSOLICITUD;

-- APROBADO | 533,447

SELECT
  SUM(CASE WHEN FECDESEMBOLSO IS NOT NULL AND FLGDESEMBOLSADO <> 1 THEN 1 ELSE 0 END) AS inconsistencias
FROM CATALOG_LHCL_PROD_BCP_EXPL.BCP_EDV_RBMBDN.T72496_MIGRACION_PLANCHON
WHERE CODMES BETWEEN 202501 AND 202512
  AND DESTIPOPERACION IN ('TARJETA CREDITO NUEVA','TARJETA CREDITO STOCK');

  -- 0
