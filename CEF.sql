WITH
BASE_DIGITAL AS (
	SELECT
		CODMES,
		CODINTERNOCOMPUTACIONAL,
		TIPO_LEAD,
		(CASE
			WHEN RESULTADO_FINAL = '1. Aprobado' THEN 1
			ELSE 0
		END) AS FLGAPROBADO,
		(CASE
			WHEN RESULTADO_FINAL = '2. Denegado' THEN 1
			ELSE 0
		END) AS FLGDENEGADO,
		(CASE
			WHEN RESULTADO_FINAL = '1. Aprobado' AND MTODESEMBOLSO != 0 THEN 1
			ELSE 0
		END) AS FLGDESEMBOLSADO,
		(CASE
			WHEN RESULTADO_FINAL = '1. Aprobado' AND MTODESEMBOLSO = 0 THEN 1
			ELSE 0
		END) AS FLGNODESEMBOLSADO,
		(CASE WHEN RESULTADO_FINAL = '1. Aprobado' THEN MTODESEMBOLSO ELSE 0 END) AS MTODESEMBOLSO
	FROM CATALOG_LHCL_PROD_BCP.BCP_EDV_RBMBDN.T72496_BASE_DIGITAL
	WHERE TIPO_CANAL NOT IN ('SALEFORCE', 'SALESFORCE') AND CODMES BETWEEN 202501 AND 202512
)
	SELECT
		CODMES,
		TIPO_LEAD,
		COUNT(*) AS CTDSOLICITUDES,
		SUM(FLGAPROBADO) AS CTDSOLICITUDESAPROBADAS,
		SUM(FLGDENEGADO) AS CTDSOLICITUDESDENEGADAS,
		SUM(FLGDESEMBOLSADO) AS CTDSOLICITUDESDESEMBOLSADAS,
		SUM(FLGNODESEMBOLSADO) AS CTDSOLICITUDESNODESEMBOLSADAS,
		SUM(MTODESEMBOLSO) AS MTODESEMBOLSADO
	FROM BASE_DIGITAL
	GROUP BY
		CODMES, TIPO_LEAD;
