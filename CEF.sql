Mira asi quedo mi CTE totalmente valido lso reigstros que me salen y cantidades

TP_BASE_PREV AS (
	SELECT
		A.CODMES,
		A.CODSOLICITUD,
		B.MATANALISTA,
		B.NBRAREAUNIDADORGANIZATIVA AS NBRAREAUNIDADORGANIZATIVAANALISTA,
		B.MATSUPERIOR,
		A.NBRAREAUNIDADORGANIZATIVAVENDEDOR,
		A.CANAL,
		A.TIPOPERACION,
		A.DESTIPOPERACION,
		COALESCE(A.PRODUCTO, B.PRODUCTO) AS PRODUCTO,
		(CASE
			WHEN A.DESPRODUCTO IS NULL AND A.TIPOPERACION = 'CREDITO CONSUMO' THEN B.DESPRODUCTO
			ELSE COALESCE(B.DESPRODUCTO, A.DESPRODUCTO)
		END) AS DESPRODUCTO,
		A.DESCAMPANIA,
		A.DESTIPEVALUACIONRIESGO,
		A.FECSOLICITUD,
		(CASE
			WHEN C.FLGDIAUTIL = 1 THEN 'SI'
			ELSE 'NO'
		END) AS FLGDIAUTIL,
		A.FECHORSOLICITUD,
		A.FECHORINICIOEVALUACION,
		A.FECHORFINEVALUACION,
		A.FECDESEMBOLSO,
		A.FECHORDESEMBOLSO,
		A.TIEMPOATENCIONSOLICITUD,
		A.TIEMPODERIVACIONANALISTA,
		A.TIEMPOATENCIONANALISTA,
		A.TIEMPOATENCIONSOLICITUDANALISTA,
		A.TIEMPODESEMBOLSOPOSTATENCIONANALISTA,
		A.NBRMONEDA,
		A.DESTIPRENTA,
		A.SEGMENTO,
		A.MTOSOLICITADO,
		A.MTOAPROBADO,
		A.MTODESEMBOLSADO,
		CASE
		   -----------------------------------------------------------------
		   -- 1) CENTRALIZADO
		   -----------------------------------------------------------------
		   WHEN B.MATANALISTA IS NOT NULL
		        AND B.NBRAREAUNIDADORGANIZATIVA = 'TRIBU RIESGOS BDN Y CREDITOS MINORISTAS'
		   THEN 'CENTRALIZADO'
		   -----------------------------------------------------------------
		   -- 2) PUNTO DE CONTACTO - CREDITO CONSUMO
		   -----------------------------------------------------------------
		   WHEN A.TIPOPERACION = 'CREDITO CONSUMO'
		        AND A.DESTIPESTADOSOLICITUD IN ('ACEPTADA', 'DESACTIVADA')
		        AND A.NBRAREAUNIDADORGANIZATIVAVENDEDOR IN (
		        	'AREA COMERCIAL PROVINCIAS 1', 'AREA COMERCIAL PROVINCIAS 2', 
		        	'AREA COMERCIAL LIMA 2', 'AREA COMERCIAL LIMA 1', 
		        	'GCIA DE AREA BANCA AFLUENTE', 'GCIA DE AREA CENTRO DE CONTACTO Y VENTAS'
		        )
		        AND A.CODMATRICULACOLABORADORANALISTA IS NULL
		   THEN 'PUNTO DE CONTACTO'
		   -----------------------------------------------------------------
		   -- 3) PUNTO DE CONTACTO - TARJETA DE CREDITO
		   -----------------------------------------------------------------
		   WHEN A.TIPOPERACION = 'TARJETA DE CREDITO'
		        AND A.DESTIPESTADOSOLICITUD IN ('ACEPTADA', 'DENEGADA')
		        AND A.DESTIPETAPA = 'CERRADA'
		        AND A.NBRAREAUNIDADORGANIZATIVAVENDEDOR IN (
		        	'AREA COMERCIAL PROVINCIAS 1', 'AREA COMERCIAL PROVINCIAS 2', 
		        	'AREA COMERCIAL LIMA 2', 'AREA COMERCIAL LIMA 1', 
		        	'GCIA DE AREA BANCA AFLUENTE', 'GCIA DE AREA CENTRO DE CONTACTO Y VENTAS'
		        )
		   THEN 'PUNTO DE CONTACTO'
		   -----------------------------------------------------------------
		   -- 4) Resto
		   -----------------------------------------------------------------
		   ELSE 'SIN INFORMACION'
		END AS CENTROATENCION
	FROM TP_BASE_UNION A
	LEFT JOIN TP_BASE_SOLICITUDES B ON (A.CODSOLICITUD = B.CODSOLICITUD)
	LEFT JOIN DIMCALENDARIO C ON (A.FECSOLICITUD = C.FECHA)
),




Ahora antes en mi version antigua tenia algo asi donde tenia el ESTADOSOLICITUD, podemos replicarlo con la nueva logica? deberia agregar una CTE posterior para hacer este calculo del estadosolicitud para no tener qu ereplicar la misma logica cada rato?



TP_BASE_PREV AS (
	SELECT
		A.CODMES,
		A.CODSOLICITUD,
		B.MATANALISTA,
		B.NBRAREAUNIDADORGANIZATIVA AS NBRAREAUNIDADORGANIZATIVAANALISTA,
		B.MATSUPERIOR,
		A.NBRAREAUNIDADORGANIZATIVAVENDEDOR,
		A.CANAL,
		A.TIPOPERACION,
		A.DESTIPOPERACION,
		COALESCE(A.PRODUCTO, B.PRODUCTO) AS PRODUCTO,
		(CASE
			WHEN A.DESPRODUCTO IS NULL AND A.TIPOPERACION = 'CREDITO CONSUMO' THEN B.DESPRODUCTO
			ELSE COALESCE(B.DESPRODUCTO, A.DESPRODUCTO)
		END) AS DESPRODUCTO,
		A.DESCAMPANIA,
		A.DESTIPEVALUACIONRIESGO,
		A.FECSOLICITUD,
		(CASE
			WHEN C.FLGDIAUTIL = 1 THEN 'SI'
			ELSE 'NO'
		END) AS FLGDIAUTIL,
		A.FECHORSOLICITUD,
		A.FECHORINICIOEVALUACION,
		A.FECHORFINEVALUACION,
		A.FECDESEMBOLSO,
		A.FECHORDESEMBOLSO,
		A.TIEMPOATENCIONSOLICITUD,
		A.TIEMPODERIVACIONANALISTA,
		A.TIEMPOATENCIONANALISTA,
		A.TIEMPOATENCIONSOLICITUDANALISTA,
		A.TIEMPODESEMBOLSOPOSTATENCIONANALISTA,
		A.NBRMONEDA,
		A.DESTIPRENTA,
		A.SEGMENTO,
		A.MTOSOLICITADO,
		A.MTOAPROBADO,
		A.MTODESEMBOLSADO,
		(CASE
			WHEN 
				A.NBRAREAUNIDADORGANIZATIVAVENDEDOR IN ('AREA COMERCIAL PROVINCIAS 1', 'AREA COMERCIAL PROVINCIAS 2', 'AREA COMERCIAL LIMA 2', 'AREA COMERCIAL LIMA 1', 'GCIA DE AREA BANCA AFLUENTE', 'GCIA DE AREA CENTRO DE CONTACTO Y VENTAS') 
				AND B.MATANALISTA IS NULL 
				AND A.DESTIPESTADOSOLICITUD IN ('DESACTIVADA', 'ACEPTADA') THEN 'PUNTO DE CONTACTO'
			WHEN B.MATANALISTA IS NOT NULL AND B.NBRAREAUNIDADORGANIZATIVA = 'TRIBU RIESGOS BDN Y CREDITOS MINORISTAS' THEN 'CENTRALIZADO'
			ELSE 'SIN INFORMACION'
		END) AS CENTROATENCION,
		(CASE
			-- Para CENTRALIZADO, manda ESTADOSOLICITUD (analista/SF)
			WHEN 
				(CASE
					WHEN 
						A.NBRAREAUNIDADORGANIZATIVAVENDEDOR IN ('AREA COMERCIAL PROVINCIAS 1', 'AREA COMERCIAL PROVINCIAS 2', 'AREA COMERCIAL LIMA 2', 'AREA COMERCIAL LIMA 1', 'GCIA DE AREA BANCA AFLUENTE', 'GCIA DE AREA CENTRO DE CONTACTO Y VENTAS') 
						AND B.MATANALISTA IS NULL 
						AND A.DESTIPESTADOSOLICITUD IN ('DESACTIVADA', 'ACEPTADA') THEN 'PUNTO DE CONTACTO'
					WHEN B.MATANALISTA IS NOT NULL AND B.NBRAREAUNIDADORGANIZATIVA = 'TRIBU RIESGOS BDN Y CREDITOS MINORISTAS' THEN 'CENTRALIZADO'
					ELSE 'SIN INFORMACION'
				END) = 'CENTRALIZADO'
				THEN B.ESTADOSOLICITUD

			-- Para PUNTO DE CONTACTO, mapeas DESTIPESTADOSOLICITUD a APROBADO/RECHAZADO
			WHEN 
				(CASE
					WHEN 
						A.NBRAREAUNIDADORGANIZATIVAVENDEDOR IN ('AREA COMERCIAL PROVINCIAS 1', 'AREA COMERCIAL PROVINCIAS 2', 'AREA COMERCIAL LIMA 2', 'AREA COMERCIAL LIMA 1', 'GCIA DE AREA BANCA AFLUENTE', 'GCIA DE AREA CENTRO DE CONTACTO Y VENTAS') 
						AND B.MATANALISTA IS NULL 
						AND A.DESTIPESTADOSOLICITUD IN ('DESACTIVADA', 'ACEPTADA') THEN 'PUNTO DE CONTACTO'
					WHEN B.MATANALISTA IS NOT NULL AND B.NBRAREAUNIDADORGANIZATIVA = 'TRIBU RIESGOS BDN Y CREDITOS MINORISTAS' THEN 'CENTRALIZADO'
					ELSE 'SIN INFORMACION'
				END) = 'PUNTO DE CONTACTO'
				AND A.DESTIPESTADOSOLICITUD = 'ACEPTADA'
				THEN 'APROBADO'

			WHEN 
				(CASE
					WHEN 
						A.NBRAREAUNIDADORGANIZATIVAVENDEDOR IN ('AREA COMERCIAL PROVINCIAS 1', 'AREA COMERCIAL PROVINCIAS 2', 'AREA COMERCIAL LIMA 2', 'AREA COMERCIAL LIMA 1', 'GCIA DE AREA BANCA AFLUENTE', 'GCIA DE AREA CENTRO DE CONTACTO Y VENTAS') 
						AND B.MATANALISTA IS NULL 
						AND A.DESTIPESTADOSOLICITUD IN ('DESACTIVADA', 'ACEPTADA') THEN 'PUNTO DE CONTACTO'
					WHEN B.MATANALISTA IS NOT NULL AND B.NBRAREAUNIDADORGANIZATIVA = 'TRIBU RIESGOS BDN Y CREDITOS MINORISTAS' THEN 'CENTRALIZADO'
					ELSE 'SIN INFORMACION'
				END) = 'PUNTO DE CONTACTO'
				AND A.DESTIPESTADOSOLICITUD = 'DESACTIVADA'
				THEN 'RECHAZADO'

			-- FALLBACK
			ELSE COALESCE(B.ESTADOSOLICITUD, A.DESTIPESTADOSOLICITUD)
		END) AS ESTADOSOLICITUD
	FROM TP_BASE_UNION A
	LEFT JOIN TP_BASE_SOLICITUDES B ON (A.CODSOLICITUD = B.CODSOLICITUD)
	LEFT JOIN DIMCALENDARIO C ON (A.FECSOLICITUD = C.FECHA)
),
