WITH
TP_BASESOLICITUDESPOWERAPPS AS (
    SELECT CODMES, CODSOLICITUD
    FROM CATALOG_LHCL_PROD_BCP.BCP_EDV_RBMBDN.T72496_BASESOLICITUDES
    WHERE CODMES = 202510
),
TP_BASESOLICITUDESSALESFORCE AS (
    SELECT CODMESEVALUACION, CODSOLICITUD
    FROM CATALOG_LHCL_PROD_BCP.BCP_EDV_RBMBDN.T72496_SALESFORCEESTADOS
    WHERE CODMESEVALUACION = 202510
),
TP_SOLICITUDCREDITOCONSUMO AS (
    SELECT CODSOLICITUD, FECSOLICITUD, DESTIPETAPA, DESTIPESTADOSOLICITUD
    FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDCREDITOCONSUMO
),
TP_SOLICITUDTARJETACREDITO AS (
    SELECT CODSOLICITUD, FECSOLICITUD, DESTIPETAPA, DESTIPFLUJOVENTATARJETACREDITO, DESTIPESTADOSOLICITUD
    FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDTARJETACREDITO
),
TP_BASEPOWERAPPS AS (
    SELECT 
        A.CODSOLICITUD,
        (CASE 
            WHEN B.CODSOLICITUD IS NOT NULL THEN 1 ELSE 0 
        END) AS EN_CEF,
        (CASE 
            WHEN C.CODSOLICITUD IS NOT NULL THEN 1 ELSE 0 
        END) AS EN_TC
    FROM TP_BASESOLICITUDES A
    LEFT JOIN TP_SOLICITUDCREDITOCONSUMO B ON A.CODSOLICITUD = B.CODSOLICITUD
    LEFT JOIN TP_SOLICITUDTARJETACREDITO C ON A.CODSOLICITUD = C.CODSOLICITUD
),
TP_BASESALESFORCE AS (
    SELECT 
        A.CODSOLICITUD,
        (CASE 
            WHEN B.CODSOLICITUD IS NOT NULL THEN 1 ELSE 0 
        END) AS EN_CEF,
        (CASE 
            WHEN C.CODSOLICITUD IS NOT NULL THEN 1 ELSE 0 
        END) AS EN_TC
    FROM TP_BASESOLICITUDES A
    LEFT JOIN TP_SOLICITUDCREDITOCONSUMO B ON A.CODSOLICITUD = B.CODSOLICITUD
    LEFT JOIN TP_SOLICITUDTARJETACREDITO C ON A.CODSOLICITUD = C.CODSOLICITUD
)
