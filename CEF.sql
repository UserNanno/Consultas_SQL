TP_COLABORADOR_BASE AS (
    SELECT
        FECDIA,
        date_format(FECDIA, 'yyyyMM') AS CODMES,
        CODMATRICULA,
        CODMATRICULASUP,
        NBRUNIDADORGANIZATIVA,
        NBRAREAUNIDADORGANIZATIVA,
        NBRSERVUNIDADORGANIZATIVA
    FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.H_COLABORADOR
    WHERE DESTIPESTADOLABORAL = 'Activo'
),






TP_COLABORADORANALISTA AS (
    SELECT
        CODMES,
        MATORGANICO,
        MATSUPERIOR,
        NBRAREAUNIDADORGANIZATIVA
    FROM (
        SELECT
            CODMES,
            CODMATRICULA      AS MATORGANICO,
            CODMATRICULASUP   AS MATSUPERIOR,
            NBRAREAUNIDADORGANIZATIVA,
            ROW_NUMBER() OVER (
                PARTITION BY CODMES, CODMATRICULA
                ORDER BY FECDIA DESC   -- Ãºltima foto del mes
            ) AS rn
        FROM TP_COLABORADOR_BASE
    ) x
    WHERE rn = 1
),








TP_COLABORADORVENDEDOR AS (
    SELECT
        FECDIA,
        CODMES,
        MATORGANICO,
        MATSUPERIOR,
        NBRUNIDADORGANIZATIVAVENDEDOR,
        NBRAREAUNIDADORGANIZATIVAVENDEDOR,
        NBRSERVUNIDADORGANIZATIVAVENDEDOR
    FROM (
        SELECT
            FECDIA,
            CODMES,
            CODMATRICULA       AS MATORGANICO,
            CODMATRICULASUP    AS MATSUPERIOR,
            NBRUNIDADORGANIZATIVA     AS NBRUNIDADORGANIZATIVAVENDEDOR,
            NBRAREAUNIDADORGANIZATIVA AS NBRAREAUNIDADORGANIZATIVAVENDEDOR,
            NBRSERVUNIDADORGANIZATIVA AS NBRSERVUNIDADORGANIZATIVAVENDEDOR,
            ROW_NUMBER() OVER (
                PARTITION BY FECDIA, CODMATRICULA
                ORDER BY FECDIA DESC
            ) AS rn
        FROM TP_COLABORADOR_BASE
    ) x
    WHERE rn = 1
),
