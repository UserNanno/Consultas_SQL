TP_BASE_TIEMPOS AS (
	SELECT
		CODMES,
		CODSOLICITUD,
		CENTROATENCION,
		CANAL,
		MATANALISTA,
		MATSUPERIOR,
	    NBRAREAUNIDADORGANIZATIVAVENDEDOR,
	    TIPOPERACION,
	    DESTIPOPERACION,
	    PRODUCTO,
	    DESPRODUCTO,
	    DESCAMPANIA,
	    DESTIPEVALUACIONRIESGO,
		FECSOLICITUD,
		day(FECSOLICITUD) AS NUMDIA,
		FLGDIAUTIL,
		FECHORSOLICITUD,
		FECHORINICIOEVALUACION,
		FECHORFINEVALUACION,
		FECDESEMBOLSO,
		FECHORDESEMBOLSO,
	    TIEMPOATENCIONSOLICITUD,
	    TIEMPODERIVACIONANALISTA,
	    TIEMPODESEMBOLSOPOSTATENCIONANALISTA,
	    DESTIPRENTA,
	    SEGMENTO,
	    ESTADOSOLICITUD,
		FLGAPROBADO,
		FLGDENEGADO,
		FLGAPROBADONORENEGOCIADO,
		FLGAPROBADORENEGOCIADO,
		FLGDESEMBOLSADO,
		FLGNODESEMBOLSADO,
		MTOSOLICITADO,
		MTOAPROBADO,
		MTODENEGADO,
		MTOAPROBADONORENEGOCIADO,
		MTOAPROBADORENEGOCIADO,
		MTODESEMBOLSADO,
		MTONODESEMBOLSADO,
		MTODENEGADOTOTAL,
		TIEMPOATENCIONANALISTA,
		(CASE
			WHEN MTOAPROBADORENEGOCIADO IS NULL THEN 'SIN INF.'
			WHEN MTOAPROBADORENEGOCIADO >= 0 AND MTOAPROBADORENEGOCIADO < 10000 THEN '0 - 10,000'
			WHEN MTOAPROBADORENEGOCIADO >= 10000 AND MTOAPROBADORENEGOCIADO < 20000 THEN '10,000 - 20,000'
			WHEN MTOAPROBADORENEGOCIADO >= 20000 AND MTOAPROBADORENEGOCIADO < 30000 THEN '20,000 - 30,000'
			WHEN MTOAPROBADORENEGOCIADO >= 30000 AND MTOAPROBADORENEGOCIADO < 40000 THEN '30,000 - 40,000'
			WHEN MTOAPROBADORENEGOCIADO >= 40000 AND MTOAPROBADORENEGOCIADO < 50000 THEN '40,000 - 50,000'
			ELSE '>= 50,000'
		END) AS BRACKETRENEGOCIADO,
		(CASE
			WHEN TIEMPOATENCIONSOLICITUD IS NULL THEN 'SIN INF.'
		    WHEN TIEMPOATENCIONSOLICITUD > 0 AND TIEMPOATENCIONSOLICITUD <= 12 THEN '0h - 12h'
		    WHEN TIEMPOATENCIONSOLICITUD > 12 and TIEMPOATENCIONSOLICITUD <= 24 THEN '12h - 24h'
	    	ELSE '>24h'
		END) AS BRACKETATENCIONSOLICITUD,
		(CASE
			WHEN TIEMPODERIVACIONANALISTA IS NULL THEN 'SIN INF.'
		    WHEN TIEMPODERIVACIONANALISTA > 0 and TIEMPODERIVACIONANALISTA <= 12 THEN '0h - 12h'
		    WHEN TIEMPODERIVACIONANALISTA > 12 and TIEMPODERIVACIONANALISTA <= 24 THEN '12h - 24h'
	    	ELSE '>24h'
		END) AS BRACKETDERIVACIONANALISTA,
		(CASE
			WHEN TIEMPOATENCIONANALISTA IS NULL THEN 'SIN INF.'
			WHEN TIEMPOATENCIONANALISTA < 0 THEN 'VALOR INVÃLIDO'
		    WHEN TIEMPOATENCIONANALISTA >= 0 AND TIEMPOATENCIONANALISTA < 1 THEN '0h - 1h'
		    WHEN TIEMPOATENCIONANALISTA >= 1 AND TIEMPOATENCIONANALISTA < 2 THEN '1h - 2h'
		    WHEN TIEMPOATENCIONANALISTA >= 2 AND TIEMPOATENCIONANALISTA < 3 THEN '2h - 3h'
		    WHEN TIEMPOATENCIONANALISTA >= 3 AND TIEMPOATENCIONANALISTA < 4 THEN '3h - 4h'
		    WHEN TIEMPOATENCIONANALISTA >= 4 AND TIEMPOATENCIONANALISTA < 5 THEN '4h - 5h'
		    WHEN TIEMPOATENCIONANALISTA >= 5 AND TIEMPOATENCIONANALISTA < 6 THEN '5h - 6h'
		    WHEN TIEMPOATENCIONANALISTA >= 6 AND TIEMPOATENCIONANALISTA < 7 THEN '6h - 7h'
		    WHEN TIEMPOATENCIONANALISTA >= 7 AND TIEMPOATENCIONANALISTA < 8 THEN '7h - 8h'
		    WHEN TIEMPOATENCIONANALISTA >= 8 AND TIEMPOATENCIONANALISTA < 9 THEN '8h - 9h'
	    	ELSE '>=9h'
		END) AS BRACKETATENCIONANALISTA,
		(CASE
			WHEN TIEMPOATENCIONSOLICITUDANALISTA IS NULL THEN 'SIN INF.'
		    WHEN TIEMPOATENCIONSOLICITUDANALISTA > 0 AND TIEMPOATENCIONSOLICITUDANALISTA <= 12 THEN '0h - 12h'
		    WHEN TIEMPOATENCIONSOLICITUDANALISTA > 12 AND TIEMPOATENCIONSOLICITUDANALISTA <= 24 THEN '12h - 24h'
	    	ELSE '>24h'
		END) AS BRACKETATENCIONSOLICITUDANALISTA,
		(CASE
			WHEN TIEMPODESEMBOLSOPOSTATENCIONANALISTA IS NULL THEN 'SIN INF.'
		    WHEN TIEMPODESEMBOLSOPOSTATENCIONANALISTA > 0 AND TIEMPODESEMBOLSOPOSTATENCIONANALISTA <= 12 THEN '0h - 12h'
		    WHEN TIEMPODESEMBOLSOPOSTATENCIONANALISTA > 12 AND TIEMPODESEMBOLSOPOSTATENCIONANALISTA <= 24 THEN '12h - 24h'
	    	ELSE '>24h'
		END) AS BRACKETDESEMBOLSOPOSTATENCIONANALISTA
	FROM TP_BASE
	WHERE CENTROATENCION IN ('CENTRALIZADO', 'PUNTO DE CONTACTO')
)
SELECT
	CODMES,
	CENTROATENCION,
	CANAL,
	MATANALISTA,
	MATSUPERIOR,
    NBRAREAUNIDADORGANIZATIVAVENDEDOR,
    ESTADOSOLICITUD,
    TIEMPOATENCIONANALISTA,
    NUMDIA,
	COUNT(*) AS CTDSOLICITUDES,
	SUM(FLGAPROBADO) AS CTDSOLICITUDESAPROBADAS,
	SUM(FLGDENEGADO) AS CTDSOLICITUDESDENEGADAS,
	SUM(FLGAPROBADONORENEGOCIADO) AS CTDSOLICITUDESNORENEGOCIADAS,
	SUM(FLGAPROBADORENEGOCIADO) AS CTDSOLICITUDESRENEGOCIADAS,
	SUM(FLGDESEMBOLSADO) AS CTDSOLICITUDESDESEMBOLSADAS,
	SUM(FLGNODESEMBOLSADO) AS CTDSOLICITUDESNODESEMBOLSADAS,
	SUM(MTOSOLICITADO) AS MTOSOLICITADO,
	SUM(MTOAPROBADO) AS MTOAPROBADO,
	SUM(MTODENEGADO) AS MTODENEGADO,
	SUM(MTOAPROBADONORENEGOCIADO) AS MTOAPROBADONORENEGOCIADO,
	SUM(MTOAPROBADORENEGOCIADO) AS MTOAPROBADORENEGOCIADO,
	SUM(MTODESEMBOLSADO) AS MTODESEMBOLSADO,
	SUM(MTONODESEMBOLSADO) AS MTONODESEMBOLSADO,
	SUM(MTODENEGADOTOTAL) AS MTODENEGADOTOTAL,
	TIPOPERACION,
	DESTIPOPERACION,
	PRODUCTO,
	DESPRODUCTO,
	DESCAMPANIA,
	DESTIPEVALUACIONRIESGO,
	FECSOLICITUD,
	FLGDIAUTIL,
	DESTIPRENTA,
	SEGMENTO,
	BRACKETRENEGOCIADO,
	BRACKETATENCIONSOLICITUD,
	BRACKETDERIVACIONANALISTA,
	BRACKETATENCIONANALISTA,
	BRACKETATENCIONSOLICITUDANALISTA,
	BRACKETDESEMBOLSOPOSTATENCIONANALISTA
FROM TP_BASE_TIEMPOS
GROUP BY
    CODMES, CENTROATENCION, CANAL, MATANALISTA, MATSUPERIOR, NBRAREAUNIDADORGANIZATIVAVENDEDOR, TIPOPERACION, DESTIPOPERACION, PRODUCTO, DESPRODUCTO,
    DESCAMPANIA, DESTIPEVALUACIONRIESGO, FECSOLICITUD, FLGDIAUTIL, ESTADOSOLICITUD, DESTIPRENTA, SEGMENTO, TIEMPOATENCIONANALISTA, NUMDIA, BRACKETRENEGOCIADO,
    BRACKETATENCIONSOLICITUD, BRACKETDERIVACIONANALISTA, BRACKETATENCIONANALISTA, BRACKETATENCIONSOLICITUDANALISTA, BRACKETDESEMBOLSOPOSTATENCIONANALISTA;
