WITH
BASE_CENTRALIZADO AS (
	SELECT
		A.CODMES,
		A.CODSOLICITUD,
		A.FECSOLICITUD,
		A.MTOSOLICITADONUEVO,
		A.MTOAPROBADOSOLESNUEVO,
		A.MTODESEMBOLSADO,
		A.FLGCAMPANIA,
		A.FLGCASTIGONUEVO,
		A.FLGREINGRESO,
		A.ESTADOFINAL,
		A.FLGDESEMBOLSO,
		(CASE WHEN A.FLGCAMPANIA = 'Con Campania' THEN 1 ELSE 0 END) AS FLGCAMPANIAORD,
		(CASE WHEN A.FLGCASTIGONUEVO = 'Con Castigo' THEN 1 ELSE 0 END) AS FLGCASTIGOORD,
		(CASE WHEN A.FLGDESEMBOLSO = 'Desembolsado' THEN 1 ELSE 0 END) AS FLGDESEMBOLSOORD,
		B.CODINTERNOCOMPUTACIONAL
	FROM CATALOG_LHCL_PROD_BCP.BCP_EDV_RBMBDN.T72496_BASE_DESEMBOLSOS_CENTRALIZADO A
	LEFT JOIN CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_V.M_SOLICITUDCREDITOCONSUMO B ON (A.CODSOLICITUD = B.CODSOLICITUD)
	WHERE A.TIPOPERACION = 'Credito Consumo Nuevo' AND ESTADOFINAL IN ('ACEPTADAS', 'DENEGADAS')
)
	SELECT
		A.CODMES,
		A.CODSOLICITUD,
		B.CODCLAVEPARTYCLI,
		-- ESTADOS
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' THEN 1 ELSE 0 END) AS FLGACEPTADAS,
		(CASE WHEN A.ESTADOFINAL = 'DENEGADAS' THEN 1 ELSE 0 END) AS FLGDENEGADO,
		
		-- LEADS
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 1 THEN 1 ELSE 0 END) AS FLGACEPTADAS_CON_CAMPANIA,
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 0 THEN 1 ELSE 0 END) AS FLGACEPTADAS_SIN_CAMPANIA,
		
		-- RENEGOCIACION
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 1 AND A.FLGCASTIGOORD = 1 THEN 1 ELSE 0 END) AS FLGACEPTADAS_CON_CAMPANIA_CON_RENEGOCIACION,
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 1 AND A.FLGCASTIGOORD = 0 THEN 1 ELSE 0 END) AS FLGACEPTADAS_CON_CAMPANIA_SIN_RENEGOCIACION,
		
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 0 AND A.FLGCASTIGOORD = 1 THEN 1 ELSE 0 END) AS FLGACEPTADAS_SIN_CAMPANIA_CON_RENEGOCIACION,
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 0 AND A.FLGCASTIGOORD = 0 THEN 1 ELSE 0 END) AS FLGACEPTADAS_SIN_CAMPANIA_SIN_RENEGOCIACION,
		
		-- DESEMBOLSO CON CAMPANIA
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 1 AND A.FLGCASTIGOORD = 1 AND A.FLGDESEMBOLSOORD = 1 THEN 1 ELSE 0 END) AS FLGACEPTADAS_CON_CAMPANIA_CON_RENEGOCIACION_CON_DESEMBOLSO,
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 1 AND A.FLGCASTIGOORD = 1 AND A.FLGDESEMBOLSOORD = 0 THEN 1 ELSE 0 END) AS FLGACEPTADAS_CON_CAMPANIA_CON_RENEGOCIACION_SIN_DESEMBOLSO,
		
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 1 AND A.FLGCASTIGOORD = 0 AND A.FLGDESEMBOLSOORD = 1 THEN 1 ELSE 0 END) AS FLGACEPTADAS_CON_CAMPANIA_SIN_RENEGOCIACION_CON_DESEMBOLSO,
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 1 AND A.FLGCASTIGOORD = 0 AND A.FLGDESEMBOLSOORD = 0 THEN 1 ELSE 0 END) AS FLGACEPTADAS_CON_CAMPANIA_SIN_RENEGOCIACION_SIN_DESEMBOLSO,
		
		-- DESEMBOLSO SIN CAMPANIA
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 0 AND A.FLGCASTIGOORD = 1 AND A.FLGDESEMBOLSOORD = 1 THEN 1 ELSE 0 END) AS FLGACEPTADAS_SIN_CAMPANIA_CON_RENEGOCIACION_CON_DESEMBOLSO,
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 0 AND A.FLGCASTIGOORD = 1 AND A.FLGDESEMBOLSOORD = 0 THEN 1 ELSE 0 END) AS FLGACEPTADAS_SIN_CAMPANIA_CON_RENEGOCIACION_SIN_DESEMBOLSO,
		
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 0 AND A.FLGCASTIGOORD = 0 AND A.FLGDESEMBOLSOORD = 1 THEN 1 ELSE 0 END) AS FLGACEPTADAS_SIN_CAMPANIA_SIN_RENEGOCIACION_CON_DESEMBOLSO,
		(CASE WHEN A.ESTADOFINAL = 'ACEPTADAS' AND A.FLGCAMPANIAORD = 0 AND A.FLGCASTIGOORD = 0 AND A.FLGDESEMBOLSOORD = 0 THEN 1 ELSE 0 END) AS FLGACEPTADAS_SIN_CAMPANIA_SIN_RENEGOCIACION_SIN_DESEMBOLSO
	FROM BASE_CENTRALIZADO A
	LEFT JOIN CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_V.M_CLIENTE B ON UPPER(TRIM(A.CODINTERNOCOMPUTACIONAL)) = UPPER(TRIM(B.CODINTERNOCOMPUTACIONAL))
