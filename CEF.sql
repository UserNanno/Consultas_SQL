MIRA HE ARMADO ESTA CTE:

WITH
TP_FECHA_CLIENTE AS (
	SELECT CODMESCAMPANIA, MAX(FECRUTINA) AS FECRUTINA
	FROM CATALOG_LHCL_PROD_BCP.BCP_DDV_CRM_CAMPANIAMASIVA_VU.HD_CONSOLIDADOCAMPANIACRM
	WHERE CODMESCAMPANIA = 202602
	GROUP BY CODMESCAMPANIA
),
TP_DATA_CLIENTE AS (
	SELECT
		CODMESCAMPANIA,
		CODINTERNOCOMPUTACIONAL,
		DESPRODUCTOVENTACRM,
		DESTIPOFERTACRM,
		MTOOFERTASOL,
		TIPSEGMENTORIESGOSCORERBM,
		DESTIPSEGMENTORIESGOSCORERBM,
		FECRUTINA
	FROM CATALOG_LHCL_PROD_BCP.BCP_DDV_CRM_CAMPANIAMASIVA_VU.HD_CONSOLIDADOCAMPANIACRM A
	WHERE CODMESCAMPANIA = 202602 AND CODPRODUCTOVENTACRM = '0006'
),
HD_CONSOLIDADOCAMPANIACRM AS (
	SELECT /*+ BROADCAST(B) */
		A.CODMESCAMPANIA,
		A.CODINTERNOCOMPUTACIONAL,
		A.DESPRODUCTOVENTACRM,
		A.DESTIPOFERTACRM,
		A.MTOOFERTASOL,
		A.TIPSEGMENTORIESGOSCORERBM,
		A.DESTIPSEGMENTORIESGOSCORERBM,
		A.FECRUTINA
	FROM TP_DATA_CLIENTE A
	INNER JOIN TP_FECHA_CLIENTE B ON (A.FECRUTINA = B.FECRUTINA AND A.CODMESCAMPANIA = B.CODMESCAMPANIA)
),
HM_SOLICITUDES_SCRM AS (
	SELECT
		CODMES,
		CODSOLICITUD,
		FECSOLICITUD,
		ESTADOSOLICITUD,
		MTOSOLICITADO,
		MTOAPROBADO,
		FECDESEMBOLSO,
		MTODESEMBOLSADO,
		(CASE WHEN DESCAMPANIA IS NOT NULL THEN 1 ELSE 0 END) AS FLGLEAD
	FROM CATALOG_LHCL_PROD_BCP.BCP_EDV_RBMBDN.T72496_HM_SOLICITUDES_SCRM
	WHERE CODMES = 202602 AND CENTROATENCION = 'CENTRALIZADO' AND DESTIPOPERACION = 'CREDITO CONSUMO'
),
M_SOLICITUDCREDITOCONSUMO AS (
	SELECT
		CODSOLICITUD,
		CODINTERNOCOMPUTACIONAL,
		CODCLAVEPARTYCLI
	FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDCREDITOCONSUMO
),
TP_BASE AS (
	SELECT
		A.CODMES,
		A.CODSOLICITUD,
		A.FECSOLICITUD,
		A.ESTADOSOLICITUD,
		A.MTOSOLICITADO,
		A.MTOAPROBADO,
		A.FECDESEMBOLSO,
		A.MTODESEMBOLSADO,
		A.FLGLEAD,
		B.CODINTERNOCOMPUTACIONAL,
		B.CODCLAVEPARTYCLI
	FROM HM_SOLICITUDES_SCRM A
	LEFT JOIN M_SOLICITUDCREDITOCONSUMO B ON (A.CODSOLICITUD = B.CODSOLICITUD)
)
	SELECT
		A.CODMES,
		A.CODSOLICITUD,
		A.FECSOLICITUD,
		A.ESTADOSOLICITUD,
		A.MTOSOLICITADO,
		A.MTOAPROBADO,
		A.FECDESEMBOLSO,
		A.MTODESEMBOLSADO,
		A.FLGLEAD,
		A.CODINTERNOCOMPUTACIONAL,
		A.CODCLAVEPARTYCLI,
	    B.DESPRODUCTOVENTACRM,
    	B.DESTIPOFERTACRM,
		B.MTOOFERTASOL,
		B.TIPSEGMENTORIESGOSCORERBM,
		B.DESTIPSEGMENTORIESGOSCORERBM
	FROM TP_BASE A
	LEFT JOIN HD_CONSOLIDADOCAMPANIACRM B ON (A.CODMES = B.CODMESCAMPANIA AND A.CODINTERNOCOMPUTACIONAL = B.CODINTERNOCOMPUTACIONAL)



PORQUE QUIERO DE MI BASE DE SOLICTUDES QUE SE ATENDIERON EN CENTRALIZADO IDENTIFICAR SU MTOOFERTADO DE LA CAMPAÑA QUE TIENEN Y SU SEGMENTORIESGO QUE PERTENENCEN
PARA ELLO HICE PREVIAMENTE ESTO, BUSCANDO UN CLIENTE EN CADA UNA DE LAS TABLAS INVOLUCRADAS,

LO CUAL ME INDICA AL FINAL QUE SI, ESE CLIENTE QUE SE ATENDIO EN CENTRALIZADO PARA EL PRODUCTO DE CREDITO CONSUMO EN EL MES DE 202602 SI TENIA UNA CAMPAÑA DE CEF (CODPRODUCTOVENTACRM = '0006')

SELECT date_format(FECSOLICITUD, 'yyyyMM') AS CODMES, CODSOLICITUD, DESCAMPANIA
FROM CATALOG_LHCL_PROD_BCP.BCP_EDV_RBMBDN.T72496_HM_SOLICITUDES_SCRM
WHERE CODMES = 202602 AND CENTROATENCION = 'CENTRALIZADO' AND DESTIPOPERACION = 'CREDITO CONSUMO' AND CODSOLICITUD = 'O0019905050';

SELECT CODSOLICITUD, TRIM(CODINTERNOCOMPUTACIONAL) AS CODINTERNOCOMPUTACIONAL
FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDCREDITOCONSUMO WHERE CODSOLICITUD = 'O0019905050';

SELECT CODMESCAMPANIA, CODPRODUCTOVENTACRM, DESPRODUCTOVENTACRM, TIPOFERTACRM, DESTIPOFERTACRM, TIPSEGMENTORIESGOSCORERBM
FROM CATALOG_LHCL_PROD_BCP.BCP_DDV_CRM_CAMPANIAMASIVA_VU.HD_CONSOLIDADOCAMPANIACRM
WHERE TRIM(CODINTERNOCOMPUTACIONAL) = '03629075' AND CODMESCAMPANIA = 202602
ORDER BY 1 DESC;


PERO POR ALGUN MOTIVO, EN LA CTE ME SALEN VALORES NULL A PESAR QUE HAGO ASI:

WITH
TP_FECHA_CLIENTE AS (
	SELECT CODMESCAMPANIA, MAX(FECRUTINA) AS FECRUTINA
	FROM CATALOG_LHCL_PROD_BCP.BCP_DDV_CRM_CAMPANIAMASIVA_VU.HD_CONSOLIDADOCAMPANIACRM
	WHERE CODMESCAMPANIA = 202602
	GROUP BY CODMESCAMPANIA
),
TP_DATA_CLIENTE AS (
	SELECT
		CODMESCAMPANIA,
		UPPER(TRIM(CODINTERNOCOMPUTACIONAL)) AS CODINTERNOCOMPUTACIONAL,
		DESPRODUCTOVENTACRM,
		DESTIPOFERTACRM,
		MTOOFERTASOL,
		TIPSEGMENTORIESGOSCORERBM,
		DESTIPSEGMENTORIESGOSCORERBM,
		FECRUTINA
	FROM CATALOG_LHCL_PROD_BCP.BCP_DDV_CRM_CAMPANIAMASIVA_VU.HD_CONSOLIDADOCAMPANIACRM A
	WHERE CODMESCAMPANIA = 202602 AND CODPRODUCTOVENTACRM = '0006'
),
HD_CONSOLIDADOCAMPANIACRM AS (
	SELECT /*+ BROADCAST(B) */
		A.CODMESCAMPANIA,
		A.CODINTERNOCOMPUTACIONAL,
		A.DESPRODUCTOVENTACRM,
		A.DESTIPOFERTACRM,
		A.MTOOFERTASOL,
		A.TIPSEGMENTORIESGOSCORERBM,
		A.DESTIPSEGMENTORIESGOSCORERBM,
		A.FECRUTINA
	FROM TP_DATA_CLIENTE A
	INNER JOIN TP_FECHA_CLIENTE B ON (A.FECRUTINA = B.FECRUTINA AND A.CODMESCAMPANIA = B.CODMESCAMPANIA)
),
HM_SOLICITUDES_SCRM AS (
	SELECT
		CODMES,
		CODSOLICITUD,
		FECSOLICITUD,
		ESTADOSOLICITUD,
		MTOSOLICITADO,
		MTOAPROBADO,
		FECDESEMBOLSO,
		MTODESEMBOLSADO,
		(CASE WHEN DESCAMPANIA IS NOT NULL THEN 1 ELSE 0 END) AS FLGLEAD
	FROM CATALOG_LHCL_PROD_BCP.BCP_EDV_RBMBDN.T72496_HM_SOLICITUDES_SCRM
	WHERE CODMES = 202602 AND CENTROATENCION = 'CENTRALIZADO' AND DESTIPOPERACION = 'CREDITO CONSUMO'
),
M_SOLICITUDCREDITOCONSUMO AS (
	SELECT
		CODSOLICITUD,
		UPPER(TRIM(CODINTERNOCOMPUTACIONAL)) AS CODINTERNOCOMPUTACIONAL,
		CODCLAVEPARTYCLI
	FROM CATALOG_LHCL_PROD_BCP.BCP_UDV_INT_VU.M_SOLICITUDCREDITOCONSUMO
),
TP_BASE AS (
	SELECT
		A.CODMES,
		A.CODSOLICITUD,
		A.FECSOLICITUD,
		A.ESTADOSOLICITUD,
		A.MTOSOLICITADO,
		A.MTOAPROBADO,
		A.FECDESEMBOLSO,
		A.MTODESEMBOLSADO,
		A.FLGLEAD,
		B.CODINTERNOCOMPUTACIONAL,
		B.CODCLAVEPARTYCLI
	FROM HM_SOLICITUDES_SCRM A
	LEFT JOIN M_SOLICITUDCREDITOCONSUMO B ON (A.CODSOLICITUD = B.CODSOLICITUD)
)
	SELECT
		A.CODMES,
		A.CODSOLICITUD,
		A.FECSOLICITUD,
		A.ESTADOSOLICITUD,
		A.MTOSOLICITADO,
		A.MTOAPROBADO,
		A.FECDESEMBOLSO,
		A.MTODESEMBOLSADO,
		A.FLGLEAD,
		A.CODINTERNOCOMPUTACIONAL,
		A.CODCLAVEPARTYCLI,
	    B.DESPRODUCTOVENTACRM,
    	B.DESTIPOFERTACRM,
		B.MTOOFERTASOL,
		B.TIPSEGMENTORIESGOSCORERBM,
		B.DESTIPSEGMENTORIESGOSCORERBM
	FROM TP_BASE A
	LEFT JOIN HD_CONSOLIDADOCAMPANIACRM B ON (A.CODMES = B.CODMESCAMPANIA AND A.CODINTERNOCOMPUTACIONAL = B.CODINTERNOCOMPUTACIONAL)
	WHERE A.CODINTERNOCOMPUTACIONAL = '03629075'


	
