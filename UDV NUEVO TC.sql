SELECT COUNT(CODEVALUACIONSOLICITUD), COUNT(DISTINCT CODEVALUACIONSOLICITUD) FROM (SELECT
	CODEVALUACIONSOLICITUD,
	CODIDEVALUACION,
	FECEVALUACION,
	CODINTERNOCOMPUTACIONAL,
	NUMSOLICITUDEVALUACION,
	CODSECUENCIALDECISIONRBM,
	DESDECISIONEVALUACION,
	DESREGLAPAUTA,
	DESTIPDECISIONRESULTADORBM,
	DESEVALUACION,
	MTOCEMEVALUACION,
	DESCAMPANIASOLICITUD,
	DESTIPEVALUACIONSOLICITUDCREDITO,
	DESCANALVENTARBMPER,
	(CASE
		WHEN DESCANALVENTARBMPER = 'SALEFORCE' THEN SUBSTR(TRIM(NUMSOLICITUDEVALUACION), 5, 7)
		WHEN DESCANALVENTARBMPER = 'LOANS' THEN SUBSTR(TRIM(NUMSOLICITUDEVALUACION), 3, 8)
		ELSE TRIM(NUMSOLICITUDEVALUACION)
	END) AS NUMSOLICITUDCORTO,
	(CASE
		WHEN DESTIPDECISIONRESULTADORBM = 'Approve' then 1
		WHEN DESTIPDECISIONRESULTADORBM = 'Decline' then 3
		ELSE 2
	END) AS RESULTADORBMJERARQUIA,
	(CASE
		WHEN DESCANALVENTARBMPER = 'BANCA MÓVIL' AND DESEVALUACION = 'df_Regular' THEN '0.No valido'
		WHEN DESCAMPANIASOLICITUD = 'Reactivo' THEN '1.Reactivo'
		ELSE '2.No Reactivo'
	END) AS EVALUACIONREACTIVO,
	(CASE
		WHEN DESTIPEVALUACIONSOLICITUDCREDITO IN ('Regular LD', 'Cuotealo') AND DESCAMPANIASOLICITUD IN ('100% Aprobado', 'Pre-Aprobado') THEN 'LD APR'
		WHEN DESTIPEVALUACIONSOLICITUDCREDITO IN ('Regular LD', 'Cuotealo') AND DESCAMPANIASOLICITUD = 'CEF Shield' THEN 'LD SHD'
		WHEN DESTIPEVALUACIONSOLICITUDCREDITO = 'Regular LD' AND DESCAMPANIASOLICITUD = 'Convenio' THEN 'LD CONV'
		WHEN DESTIPEVALUACIONSOLICITUDCREDITO = 'Regular LD' AND DESCAMPANIASOLICITUD = 'Invitado' THEN 'LD INV'
		
		WHEN DESTIPEVALUACIONSOLICITUDCREDITO = 'Compra de Deuda' AND DESCAMPANIASOLICITUD IN ('100% Aprobado', 'Pre-Aprobado') THEN 'CDD APR'
		WHEN DESTIPEVALUACIONSOLICITUDCREDITO = 'Compra de Deuda' AND DESCAMPANIASOLICITUD = 'Convenio' THEN 'CDD CONV'
		
		WHEN DESTIPEVALUACIONSOLICITUDCREDITO = 'LD + Consolidación' AND DESCAMPANIASOLICITUD IN ('100% Aprobado', 'Pre-Aprobado') THEN 'REE APR'
		WHEN DESTIPEVALUACIONSOLICITUDCREDITO = 'LD + Consolidación' AND DESCAMPANIASOLICITUD = 'Convenio'  THEN 'REE CONV'
		
		WHEN DESTIPEVALUACIONSOLICITUDCREDITO = 'LD + Compra de Deuda + Consolidación' AND DESCAMPANIASOLICITUD IN ('100% Aprobado', 'Pre-Aprobado') THEN 'CONS APR'
		WHEN DESTIPEVALUACIONSOLICITUDCREDITO = 'LD + Compra de Deuda + Consolidación' AND DESCAMPANIASOLICITUD = 'Convenio' THEN 'CONS CONV'
		
		ELSE 'REACTIVO'
	END) AS LEAD_CEF
FROM CATALOG_LHCL_PROD_BCP.BCP_DDV_RBMRBMPER_MODELOGESTION_VU.MD_EVALUACIONSOLICITUDCREDITO
WHERE TIPPRODUCTOSOLICITUDRBM = 'CC' AND DESCANALVENTARBMPER NOT IN ('YAPE', 'OTROS'))


