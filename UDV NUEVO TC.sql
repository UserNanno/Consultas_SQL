INSERT OVERWRITE TABLE catalog_lhcl_prod_bcp.bcp_edv_rbmbdn.T72496_SOLICITUDES_HIST
PARTITION (CODMES=' || CAST(v_mes AS STRING) || ')
(CODINTERNOCOMPUTACIONAL, TIPO_LEAD, TIPO_EVALUACION, TIPO_CANAL, CANAL_F,
 RESULTADO_FINAL, RESULTADO_FINAL_UNICO, FLG_MTOSOLICITUD, FLG_MTOVENTA,
 RESULTADO_CDA, DESCAMPANA, DECISION, C, MTODESEMBOLSO, MTOSOLICITADO,
 NUM_SOLICITUDES, MTO_OFERTA)
SELECT
  A.CODINTERNOCOMPUTACIONAL,
  CASE WHEN L.CIC IS NOT NULL THEN \'CON_LEAD\' ELSE \'SIN_LEAD\' END AS TIPO_LEAD,
  A.TIPO_EVALUACION,
  A.TIPO_CANAL,
  A.CANAL_F,
  A.RESULTADO_FINAL,
  A.RESULTADO_FINAL_UNICO,
  A.FLG_MTOSOLICITUD,
  A.FLG_MTOVENTA,
  A.RESULTADO_CDA,
  A.DESCAMPANA,
  A.DECISION,
  COUNT(1)                      AS C,
  SUM(A.MTODESEMBOLSADOSOL_VTA)  AS MTODESEMBOLSO,
  SUM(A.MTOSOLICITADO_SLF)       AS MTOSOLICITADO,
  MAX(A.NUM_SOLICITUDES)         AS NUM_SOLICITUDES,
  SUM(A.MTO_OFERTA_LEAD)         AS MTO_OFERTA
FROM BASE_RK1 A
LEFT JOIN LEADS_MES L
  ON L.CODMES = ' || CAST(v_mes AS STRING) || '
 AND TRIM(L.CIC)=TRIM(A.CODINTERNOCOMPUTACIONAL)
GROUP BY
  A.CODINTERNOCOMPUTACIONAL,
  CASE WHEN L.CIC IS NOT NULL THEN \'CON_LEAD\' ELSE \'SIN_LEAD\' END,
  A.TIPO_EVALUACION,
  A.TIPO_CANAL,
  A.CANAL_F,
  A.RESULTADO_FINAL,
  A.RESULTADO_FINAL_UNICO,
  A.FLG_MTOSOLICITUD,
  A.FLG_MTOVENTA,
  A.RESULTADO_CDA,
  A.DESCAMPANA,
  A.DECISION
';
